# é–‹ç™¼ç´€éŒ„ (Development Log)

## 2025-06-10 ç³»çµ±å„ªåŒ–èˆ‡åŠŸèƒ½é‡æ§‹

### ğŸ¯ é–‹ç™¼ç›®æ¨™
- ç³»çµ±å…¨é¢æª¢æŸ¥å’ŒåŠŸèƒ½é©—è­‰
- ä¿®å¾©å ±å‘Šç”Ÿæˆä¸­çš„ç¼ºå¤±è³‡è¨Š
- å„ªåŒ–ç›¸ä¼¼åº¦æª¢æ¸¬ç­–ç•¥
- æ–°å¢æ—¥èªŒè¨˜éŒ„åŠŸèƒ½

### ğŸ“‹ å•é¡Œè­˜åˆ¥èˆ‡è§£æ±º

#### 1. åˆå§‹å•é¡Œæª¢æ¸¬
**å•é¡Œæè¿°**ï¼šHTMLå ±å‘Šç¼ºå°‘é‡è¦è³‡è¨Š
- ç¼ºå°‘AIå·¥å…·ä½œç­”å«Œç–‘åº¦è©•ä¼°
- GenAIå’ŒlocalæŠ„è¥²åº¦åˆ†æä¸å®Œæ•´
- æ‰€æœ‰åˆ†æ•¸é¡¯ç¤ºç‚º0åˆ†
- æ²’æœ‰AIè¼¸å‡ºè¨˜éŒ„

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä¿®å¾© `backend/gemini_client.py` ä¸­ `grade_block` åƒæ•¸ç¼ºå¤±å•é¡Œ
- æ”¹å–„ `backend/analyzer.py` æœ¬åœ°è©•åˆ†ç®—æ³•ï¼Œæä¾›åˆç†çš„åˆ†æ•¸ç¯„åœ
- æ–°å¢AIé¢¨éšªè©•ä¼°åŠŸèƒ½åˆ°HTMLå ±å‘Šä¸­

#### 2. ç³»çµ±æ¶æ§‹å„ªåŒ–

**matplotlib ç·šç¨‹å•é¡Œä¿®å¾©**ï¼š
```python
# backend/visualization.py
matplotlib.use('Agg')  # ä½¿ç”¨éGUIå¾Œç«¯ï¼Œé¿å…ç·šç¨‹å•é¡Œ
```

**Gemini APIæ•´åˆæ”¹å–„**ï¼š
```python
# ä¿®å¾©å‰
batch_scores = await self.gemini_client.grade_responses_batch(batch_texts, rubric, qid)

# ä¿®å¾©å¾Œ  
batch_scores, batch_ai_risks = await self.gemini_client.grade_responses_batch(batch_texts, rubric, qid)
```

#### 3. ç›¸ä¼¼åº¦æª¢æ¸¬ç­–ç•¥é‡æ§‹

**åŸå§‹ç­–ç•¥**ï¼šAI + æœ¬åœ°é›™é‡æª¢æ¸¬ï¼Œè¼¸å‡º 0-2 æ¨™è¨˜
**æ–°ç­–ç•¥**ï¼šç´”æœ¬åœ°æª¢æ¸¬ï¼Œè¼¸å‡º 0-100 åˆ†æ•¸

**ä¸»è¦ä¿®æ”¹**ï¼š
- `backend/similarity_detector.py`ï¼šç§»é™¤AIç›¸ä¼¼åº¦æª¢æ¸¬ï¼Œå¼·åˆ¶ä½¿ç”¨æœ¬åœ°ç®—æ³•
- `backend/analyzer.py`ï¼šå°‡ `similarity_flags` æ”¹ç‚º `similarity_scores`
- `backend/visualization.py`ï¼šç§»é™¤GenAIç›¸ä¼¼åº¦çŸ©é™£ï¼Œä¿ç•™æœ¬åœ°ç®—æ³•çŸ©é™£

```python
# èˆŠç‰ˆæœ¬
def _calculate_flags_from_matrix(self, matrix: np.ndarray) -> List[int]:
    return [2 if score > 0.7 else 1 if score > 0.3 else 0 for score in max_scores]

# æ–°ç‰ˆæœ¬  
def _calculate_scores_from_matrix(self, matrix: np.ndarray) -> List[int]:
    return [int(score * 100) for score in max_scores]
```

#### 4. æ—¥èªŒç³»çµ±å¯¦ä½œ

**æ–°å¢åŠŸèƒ½**ï¼šå®Œæ•´çš„æ§åˆ¶å°è¼¸å‡ºè¨˜éŒ„åˆ°æª”æ¡ˆ
- å¯¦ä½œ `CombinedLogHandler` é¡åˆ¥
- åŒæ™‚è¼¸å‡ºåˆ°å‰ç«¯å’Œå„²å­˜åˆ°æª”æ¡ˆ
- æª”æ¡ˆå‘½åæ ¼å¼ï¼š`AI_TA_Grader_Log_YYYYMMDD_HHMMSS.log`

```python
# app.py ä¸­çš„æ—¥èªŒè™•ç†å™¨
class CombinedLogHandler(logging.Handler):
    def __init__(self, callback, log_file_path):
        super().__init__()
        self.callback = callback
        self.log_file_path = log_file_path
        self.log_messages = []
    
    def emit(self, record):
        msg = self.format(record)
        # ç™¼é€åˆ°å‰ç«¯
        if self.callback:
            self.callback(msg)
        # è¨˜éŒ„åˆ°å…§å­˜ä¸­
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        log_entry = f"[{timestamp}] {msg}"
        self.log_messages.append(log_entry)
```

### ğŸ”§ æŠ€è¡“ä¿®æ”¹æ‘˜è¦

#### æª”æ¡ˆä¿®æ”¹æ¸…å–®
1. **app.py**
   - æ–°å¢ `CombinedLogHandler` é¡åˆ¥
   - æ•´åˆæ—¥èªŒè¨˜éŒ„åŠŸèƒ½
   - ç§»é™¤xlsxå ±å‘Šè¼¸å‡º

2. **backend/analyzer.py**
   - æ”¹å–„æœ¬åœ°è©•åˆ†ç®—æ³• (`_estimate_score_local`)
   - æ–°å¢é—œéµè©åŠ åˆ†æ©Ÿåˆ¶
   - ä¿®æ”¹ç›¸ä¼¼åº¦è™•ç†é‚è¼¯

3. **backend/gemini_client.py**
   - ä¿®å¾© `grade_block` åƒæ•¸å•é¡Œ
   - æ–°å¢ AI é¢¨éšªè©•ä¼°åŠŸèƒ½
   - æ”¹å–„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

4. **backend/similarity_detector.py**
   - ç§»é™¤ AI ç›¸ä¼¼åº¦æª¢æ¸¬
   - å¼·åˆ¶ä½¿ç”¨æœ¬åœ°ç®—æ³•ï¼ˆ`use_genai=False`ï¼‰
   - è¼¸å‡º 0-100 åˆ†æ•¸è€Œé 0-2 æ¨™è¨˜

5. **backend/visualization.py**
   - ç§»é™¤ GenAI ç›¸ä¼¼åº¦çŸ©é™£ç”Ÿæˆ
   - æ–°å¢è©³ç´°ç›¸ä¼¼åº¦åˆ†æè¡¨æ ¼
   - æ”¹å–„ HTML å ±å‘Šæ ¼å¼

### ğŸ“Š åŠŸèƒ½é©—è­‰çµæœ

#### æ¸¬è©¦æª”æ¡ˆ
- **è¼¸å…¥**ï¼š`Final_Report_Updated_Test.csv` (3ä½å­¸ç”Ÿï¼ŒåŠå°é«”å·¥ç¨‹è€ƒè©¦)
- **å•é¡Œå…§å®¹**ï¼š
  - Q1: Czochralski vs Floating Zone è£½ç¨‹æ¯”è¼ƒ
  - Q2: CVD æ©Ÿåˆ¶åˆ†æå’Œ MBE åŸç†

#### ç›¸ä¼¼åº¦æª¢æ¸¬çµæœ
- **Q1 ç›¸ä¼¼åº¦åˆ†æ•¸**ï¼š[82, 11, 86] - æª¢æ¸¬åˆ°é«˜ç›¸ä¼¼åº¦
- **Q2 ç›¸ä¼¼åº¦åˆ†æ•¸**ï¼š[8, 9, 9] - ä½ç›¸ä¼¼åº¦ï¼Œæ­£å¸¸ç¯„åœ

#### API æ¸¬è©¦çµæœ
- **Gemini 2.5 Pro Exp**ï¼šâŒ ç„¡å…è²»é…é¡
- **Gemini 1.5 Pro**ï¼šâŒ é…é¡å·²ç”¨ç›¡  
- **Gemini 1.5 Flash**ï¼šâœ… æˆåŠŸé‹è¡Œ

### ğŸ¨ å ±å‘Šæ”¹å–„

#### HTML å ±å‘Šæ–°å¢åŠŸèƒ½
1. **AI ä½¿ç”¨å«Œç–‘åº¦è¡¨æ ¼**ï¼šè‰²å½©ç·¨ç¢¼é¡¯ç¤ºé¢¨éšªç­‰ç´š
2. **è©³ç´°ç›¸ä¼¼åº¦åˆ†æè¡¨**ï¼š0-100åˆ†æ•¸åˆ¶ï¼Œå››ç´šé¡è‰²åˆ†é¡
3. **è¦–è¦ºåŒ–çŸ©é™£**ï¼šåƒ…ä¿ç•™æœ¬åœ°ç®—æ³•çŸ©é™£
4. **å®Œæ•´æ•¸æ“šè¡¨**ï¼šåŒ…å«æ‰€æœ‰åˆ†æ•¸å’Œé¢¨éšªè©•ä¼°

#### è‰²å½©ç·¨ç¢¼æ¨™æº–
- **AI é¢¨éšª**ï¼šé«˜(â‰¥70)ç´…è‰²ã€ä¸­(40-69)æ©˜è‰²ã€ä½(<40)ç¶ è‰²
- **ç›¸ä¼¼åº¦**ï¼šé«˜(â‰¥85)ç´…è‰²ã€ä¸­(70-84)æ©˜è‰²ã€ä½(50-69)é»ƒè‰²ã€ç„¡(<50)ç¶ è‰²

### ğŸš€ ç³»çµ±é‹è¡Œç‹€æ…‹

#### ç•¶å‰é…ç½®
- **API æ¨¡å‹**ï¼šGemini 1.5 Flash (æ¨è–¦)
- **ç›¸ä¼¼åº¦æª¢æ¸¬**ï¼šç´”æœ¬åœ°ç®—æ³•
- **è©•åˆ†æ©Ÿåˆ¶**ï¼šAIè©•åˆ† + æœ¬åœ°å¾Œå‚™
- **å ±å‘Šæ ¼å¼**ï¼šCSV + HTML
- **æ—¥èªŒè¨˜éŒ„**ï¼šå®Œæ•´æ§åˆ¶å°è¼¸å‡º

#### æ€§èƒ½è¡¨ç¾
- âœ… æœ¬åœ°ç›¸ä¼¼åº¦æª¢æ¸¬ï¼šæ­£å¸¸é‹ä½œ
- âœ… AI è©•åˆ†ç³»çµ±ï¼šä½¿ç”¨ 1.5 Flash æˆåŠŸ
- âœ… AI é¢¨éšªè©•ä¼°ï¼šæ­£å¸¸ç”¢ç”Ÿ
- âœ… å ±å‘Šç”Ÿæˆï¼šå®Œæ•´ä¸”æº–ç¢º
- âœ… æ—¥èªŒè¨˜éŒ„ï¼šæˆåŠŸå„²å­˜

### ğŸ’¡ å»ºè­°èˆ‡æ³¨æ„äº‹é …

#### API ä½¿ç”¨å»ºè­°
1. **é¦–é¸æ¨¡å‹**ï¼š`gemini-1.5-flash-latest` (è¼ƒå¯¬é¬†çš„é…é¡é™åˆ¶)
2. **å‚™é¸æ¨¡å‹**ï¼š`gemini-1.5-pro-latest` (æ›´é«˜å“è³ªä½†é…é¡è¼ƒåš´)
3. **é¿å…ä½¿ç”¨**ï¼š`gemini-2.5-pro-exp` (ç„¡å…è²»é…é¡)

#### ç³»çµ±ç‰¹æ€§
- **æ··åˆæ¨¡å¼**ï¼šå¯åœ¨æœ‰/ç„¡ API é‡‘é‘°æƒ…æ³ä¸‹é‹è¡Œ
- **graceful degradation**ï¼šAPI å¤±æ•—æ™‚è‡ªå‹•åˆ‡æ›æœ¬åœ°è©•åˆ†
- **å·¥æ¥­ç´šç›¸ä¼¼åº¦æª¢æ¸¬**ï¼š6ç¨®ç®—æ³•çµ„åˆï¼Œç„¡éœ€ä¾è³´AI
- **å®Œæ•´è¨˜éŒ„**ï¼šæ‰€æœ‰æ“ä½œéƒ½æœ‰è©³ç´°æ—¥èªŒ

### ğŸ“ˆ æœªä¾†é–‹ç™¼æ–¹å‘
1. **æ‰¹æ¬¡è™•ç†å„ªåŒ–**ï¼šæå‡å¤§é‡è³‡æ–™è™•ç†æ•ˆç‡
2. **è©•åˆ†æ¨™æº–å®¢è£½åŒ–**ï¼šå…è¨±ä½¿ç”¨è€…è‡ªå®šç¾©è©•åˆ†rubrics
3. **å¤šèªè¨€æ”¯æ´**ï¼šæ“´å±•åˆ°å…¶ä»–èªè¨€çš„æ–‡æœ¬åˆ†æ
4. **é€²éšç›¸ä¼¼åº¦ç®—æ³•**ï¼šåŠ å…¥æ›´å¤šå­¸è¡“æŠ„è¥²æª¢æ¸¬æ–¹æ³•

---

**é–‹ç™¼è€…**ï¼šOdindino  
**å®Œæˆæ—¥æœŸ**ï¼š2025-06-10  
**ç‰ˆæœ¬**ï¼šEnhanced v2.0  
**ç‹€æ…‹**ï¼šProduction Ready âœ…